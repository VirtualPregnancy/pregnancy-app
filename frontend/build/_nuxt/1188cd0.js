(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{462:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var o=n(182);var r=n(205),l=n(142);function c(e){return function(e){if(Array.isArray(e))return Object(o.a)(e)}(e)||Object(r.a)(e)||Object(l.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},475:function(e,t,n){var content=n(493);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(26).default)("0101f8a7",content,!0,{sourceMap:!1})},479:function(e,t,n){"use strict";n.r(t);var o=n(30),r=(n(107),n(36),n(6),n(65),n(108),n(10),n(19),n(12),n(20),n(264));function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=l()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var o=new(Function.bind.apply(e,a));return n&&Object(r.a)(o,n.prototype),o},c.apply(null,arguments)}var d=n(462),h=n(1),m=n(28),f=n(29);n(21),n(69),n(91),n(85),n(66),n(17),n(13);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function T(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(h.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var w=function(){function e(t,n){Object(m.a)(this,e),this.THREE=t,this.scene=n,this.currentVTKMesh=null,this.wireframeMesh=null,this.lightingInitialized=!1}var t,n;return Object(f.a)(e,[{key:"loadVTKFile",value:(n=Object(o.a)(regeneratorRuntime.mark((function e(t){var n,o,r,l,c,d,h,m,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:{},o=n.modelSize||420,r=T({displayName:"VTK Model",color:16720418,opacity:.9,modelSize:o,lineWidth:n.lineWidth||Math.max(2,Math.round(o/70)),pointSize:n.pointSize||Math.max(8,Math.round(o/17)),enableWireframe:!0,onProgress:null,onComplete:null},n),console.log("[VTKLoader] Loading VTK file: ".concat(t),r),r.onProgress&&r.onProgress("Loading ".concat(r.displayName,"..."),0),e.prev=5,e.next=8,this.fetchVTKFile(t,r.onProgress);case 8:return l=e.sent,c=this.parseVTKData(l,r.onProgress,r.modelSize),d=c.geometry,h=c.isPointCloud,m=this.createVTKMesh(d,h,r),this.addToScene(m,r),r.onComplete&&r.onComplete(m,h),console.log("[VTKLoader] Successfully loaded: ".concat(r.displayName)),e.abrupt("return",{success:!0,mesh:m,isPointCloud:h});case 18:return e.prev=18,e.t0=e.catch(5),console.error("[VTKLoader] Failed to load VTK file ".concat(t,":"),e.t0),e.abrupt("return",{success:!1,error:e.t0});case 22:case"end":return e.stop()}}),e,this,[[5,18]])}))),function(e){return n.apply(this,arguments)})},{key:"fetchVTKFile",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(t){var n,o,r,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:null,console.log("[VTKLoader] Fetching VTK file..."),n&&n("Downloading file...",10),e.next=5,fetch(t);case 5:if((o=e.sent).ok){e.next=8;break}throw new Error("HTTP ".concat(o.status,": ").concat(o.statusText));case 8:return e.next=10,o.text();case 10:return r=e.sent,console.log("[VTKLoader] VTK file loaded, size:",r.length,"characters"),n&&n("File downloaded, parsing data...",30),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"parseVTKData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;console.log("[VTKLoader] Starting VTK data parsing..."),t&&t("Parsing VTK data structure...",40);for(var o=e.split("\n"),r=[],l=!1,c=!1,h=[],m=0,f=0,i=0;i<o.length;i++){var line=o[i].trim();if(t&&i%1e3==0){var progress=40+i/o.length*30;t("Parsing VTK data...",progress)}if(line.startsWith("POINTS")){var v=line.split(" ");m=parseInt(v[1]),console.log("[VTKLoader] Found",m,"3D points in VTK file"),l=!0,c=!1}else if(line.startsWith("CELLS")||line.startsWith("POLYGONS")||line.startsWith("LINES")){var T=line.split(" ");T.length>1&&(f=parseInt(T[1]),console.log("[VTKLoader] Found",f,"cells/connections in VTK file")),l=!1,c=!0}else{if(l&&h.length<3*m){var w=line.split(" ").filter((function(e){return""!==e})).map(parseFloat);h.push.apply(h,Object(d.a)(w))}if(c&&""!==line.trim()&&!line.startsWith("CELL_TYPES")&&!line.startsWith("POINT_DATA")&&!line.startsWith("SCALARS")&&!line.startsWith("LOOKUP_TABLE")){var y=line.split(" ").filter((function(e){return""!==e})),V=y.map((function(e){return parseInt(e)})).filter((function(e){return!isNaN(e)}));if(V.length>1){var L=V[0];if(0===r.length&&V.length===L+1&&(console.log("[VTKLoader] First valid cell example:",V),console.log("[VTKLoader] Cell size:",L,"Total indices:",V.length)),V.length===L+1)for(var E=1;E<L;E++){var K=V[E],R=V[E+1];void 0===R||isNaN(K)||isNaN(R)||3*K+2<h.length&&3*R+2<h.length&&r.push(h[3*K],h[3*K+1],h[3*K+2],h[3*R],h[3*R+1],h[3*R+2])}}}(line.startsWith("CELL_TYPES")||line.startsWith("POINT_DATA"))&&(c=!1)}}console.log("[VTKLoader] Parsing complete:",h.length/3,"points processed"),console.log("[VTKLoader] Created",r.length/6,"line segments for rendering"),t&&t("Creating 3D geometry...",70),0===r.length&&(console.warn("[VTKLoader] No line segments created! Using point cloud fallback."),console.log("[VTKLoader] Points array length:",h.length),console.log("[VTKLoader] Expected points:",3*m));var P=new this.THREE.BufferGeometry;if(0===r.length&&h.length>0)return console.log("[VTKLoader] Creating point cloud fallback visualization..."),P.setAttribute("position",new this.THREE.Float32BufferAttribute(h,3)),{geometry:P,isPointCloud:!0};P.setAttribute("position",new this.THREE.Float32BufferAttribute(r,3)),P.computeBoundingBox();var M=P.boundingBox.getCenter(new this.THREE.Vector3),x=P.boundingBox.getSize(new this.THREE.Vector3),k=Math.max(x.x,x.y,x.z),z=n/k;return console.log("[VTKLoader] Model bounding box size:",x),console.log("[VTKLoader] Largest dimension:",k),console.log("[VTKLoader] Target model size:",n,"units"),console.log("[VTKLoader] Applied scale factor:",z),P.translate(-M.x,-M.y,-M.z),P.scale(z,z,z),t&&t("Geometry created, building materials...",80),{geometry:P,isPointCloud:!1}}},{key:"createVTKMesh",value:function(e,t,n){var o;if(t){console.log("[VTKLoader] Creating point cloud visualization");var r=new this.THREE.PointsMaterial({color:n.color,size:n.pointSize,transparent:!0,opacity:n.opacity,sizeAttenuation:!0});o=new this.THREE.Points(e,r)}else{console.log("[VTKLoader] Creating line segment visualization");var l=new this.THREE.LineBasicMaterial({color:n.color,linewidth:n.lineWidth,transparent:!0,opacity:n.opacity});if(o=new this.THREE.LineSegments(e,l),n.enableWireframe){var c=new this.THREE.LineBasicMaterial({color:16777215&n.color|8947848,linewidth:Math.max(1,n.lineWidth-2),transparent:!0,opacity:.3*n.opacity}),d=new this.THREE.LineSegments(e,c);d.position.copy(o.position),d.scale.copy(o.scale),d.scale.multiplyScalar(1.005),this.wireframeMesh=d}}return o}},{key:"addToScene",value:function(e,t){this.currentVTKMesh&&this.scene.remove(this.currentVTKMesh),this.wireframeMesh&&this.wireframeMesh!==e&&this.scene.remove(this.wireframeMesh),this.setupSceneLighting(),this.currentVTKMesh=e,this.scene.add(e),this.wireframeMesh&&(this.scene.add(this.wireframeMesh),console.log("[VTKLoader] Added wireframe overlay for enhanced detail")),console.log("[VTKLoader] VTK model successfully added to scene:",e),e.geometry&&e.geometry.attributes&&e.geometry.attributes.position&&console.log("[VTKLoader] Total vertices in geometry:",e.geometry.attributes.position.count)}},{key:"setupSceneLighting",value:function(){if(!this.lightingInitialized){var e=new this.THREE.AmbientLight(6702148,.6);this.scene.add(e);var t=new this.THREE.DirectionalLight(16777215,.8);t.position.set(10,10,5),t.castShadow=!0,this.scene.add(t);var n=new this.THREE.DirectionalLight(16772829,.4);n.position.set(-5,3,-1),this.scene.add(n);var o=new this.THREE.DirectionalLight(11206655,.3);o.position.set(0,-5,10),this.scene.add(o);var r=new this.THREE.PointLight(16737894,.5,100);r.position.set(0,0,0),this.scene.add(r);var l=new this.THREE.PointLight(6711039,.3,80);l.position.set(20,-10,15),this.scene.add(l),this.lightingInitialized=!0,console.log("[VTKLoader] Enhanced lighting system initialized")}}},{key:"setCameraPosition",value:function(e){var t=T({position:[115,80,115],target:[0,0,0],up:[0,1,0]},e);console.log("[VTKLoader] Setting camera position:",t);var n=c(this.THREE.Vector3,Object(d.a)(t.position)),o=c(this.THREE.Vector3,Object(d.a)(t.target)),r=c(this.THREE.Vector3,Object(d.a)(t.up));if(n.distanceTo(o)<.1&&(console.warn("[VTKLoader] Camera position too close to target, adjusting..."),t.position=[60,40,60]),this.copperScene&&this.copperScene.camera){var l=this.copperScene.camera;try{var h;(h=l.position).set.apply(h,Object(d.a)(t.position)),l.lookAt(c(this.THREE.Vector3,Object(d.a)(t.target))),l.up.copy(r),l.updateProjectionMatrix(),l.updateMatrixWorld(),console.log("[VTKLoader] Camera position updated successfully")}catch(e){console.error("[VTKLoader] Error setting camera position:",e),l.position.set(60,40,60),l.lookAt(new this.THREE.Vector3(0,0,0)),l.up.set(0,1,0)}}else console.warn("[VTKLoader] Camera not accessible through current scene setup")}},{key:"setPredefinedView",value:function(e){var t={front:{position:[0,0,180],target:[0,0,0],up:[0,1,0]},top:{position:[0,180,0],target:[0,0,0],up:[0,0,-1]},side:{position:[180,0,0],target:[0,0,0],up:[0,1,0]},isometric:{position:[140,105,140],target:[0,0,0],up:[0,1,0]},closeup:{position:[80,60,80],target:[0,0,0],up:[0,1,0]},wide:{position:[250,180,250],target:[0,0,0],up:[0,1,0]}};t[e]?(this.setCameraPosition(t[e]),console.log("[VTKLoader] Set camera to ".concat(e," view"))):(console.warn("[VTKLoader] Unknown view: ".concat(e)),console.log("[VTKLoader] Available views:",Object.keys(t)))}},{key:"setCopperScene",value:function(e){this.copperScene=e,console.log("[VTKLoader] Copper scene reference set for camera control")}},{key:"getOptimalCameraPosition",value:function(){if(!this.currentVTKMesh||!this.currentVTKMesh.geometry)return{position:[140,105,140],target:[0,0,0],up:[0,1,0]};this.currentVTKMesh.geometry.computeBoundingBox();var e=this.currentVTKMesh.geometry.boundingBox,t=e.getSize(new this.THREE.Vector3),n=e.getCenter(new this.THREE.Vector3),o=.9*Math.max(t.x,t.y,t.z);return{position:[n.x+.7*o,n.y+.5*o,n.z+.7*o],target:[n.x,n.y,n.z],up:[0,1,0]}}},{key:"dispose",value:function(){this.currentVTKMesh&&(this.scene.remove(this.currentVTKMesh),this.currentVTKMesh=null),this.wireframeMesh&&(this.scene.remove(this.wireframeMesh),this.wireframeMesh=null),this.copperScene=null,console.log("[VTKLoader] Resources cleaned up")}}]),e}(),y={data:function(){return{Copper:null,THREE:null,baseRenderer:null,container:null,modelName:"Loading Placental Vessel Network...",helloworld:"",model:null,vtkLoader:null,initializationAttempts:0}},computed:{mdAndUp:function(){return this.$vuetify.breakpoint.mdAndUp}},mounted:function(){this.initializeWithRetry()},methods:{initializeWithRetry:function(){var e=arguments,t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o,r,l,c,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.length>0&&void 0!==e[0]?e[0]:0,r=e.length>1&&void 0!==e[1]?e[1]:5,l=500*o,t.initializationAttempts=o+1,t.modelName=0===o?"Initializing 3D engine...":"Retrying 3D initialization... (".concat(o,"/").concat(r,")"),n.prev=5,n.next=8,new Promise((function(e){return setTimeout(e,l)}));case 8:if(console.log("[Model] Attempt ".concat(t.initializationAttempts,": Checking plugin availability")),t.$Copper&&t.$three&&t.$baseRenderer&&t.$baseContainer){n.next=22;break}if(c=[],t.$Copper||c.push("$Copper"),t.$three||c.push("$three"),t.$baseRenderer||c.push("$baseRenderer"),t.$baseContainer||c.push("$baseContainer"),console.warn("[Model] Missing plugins: ".concat(c.join(", "))),!(o<r)){n.next=21;break}return console.log("[Model] Plugins not ready, retrying... (".concat(o+1,"/").concat(r+1,")")),n.abrupt("return",t.initializeWithRetry(o+1,r));case 21:throw new Error("3D plugins failed to load after maximum retries. Missing: ".concat(c.join(", ")));case 22:if(console.log("[Model] All plugins available, initializing..."),t.modelName="Setting up 3D environment...",t.Copper=t.$Copper(),t.THREE=t.$three(),t.baseRenderer=t.$baseRenderer(),d=t.$baseContainer(),t.container=t.$refs.baseDomObject,t.container){n.next=31;break}throw new Error("Model container DOM element not found");case 31:return console.log("[Model] DOM container found, setting up..."),t.modelName="Preparing 3D viewport...",n.next=35,new Promise((function(e){return setTimeout(e,100)}));case 35:return t.mdAndUp?d.style.height="100vh":d.style.height="100vw",t.container.innerHTML="",t.container.appendChild(d),console.log("[Model] Container appended, initializing VTK loader..."),t.modelName="Loading 3D models...",t.initializeVTKLoader(),n.next=43,t.start();case 43:t.addResizeListener(d),console.log("[Model] 3D environment initialized successfully"),n.next=52;break;case 47:n.prev=47,n.t0=n.catch(5),console.error("[Model] Initialization failed:",n.t0),t.modelName="Error: ".concat(n.t0.message),o<r&&(console.log("[Model] Will retry after longer delay..."),setTimeout((function(){return t.initializeWithRetry(o+1,r)}),2e3));case 52:case"end":return n.stop()}}),n,null,[[5,47]])})))()},addResizeListener:function(e){var t=this;window.addEventListener("resize",(function(){setTimeout((function(){t.scene&&e&&(t.mdAndUp?e.style.height="100vh":e.style.height="100vw",t.scene.onWindowResize())}),500)}))},initializeVTKLoader:function(){this.scene=this.baseRenderer.getSceneByName("placental-scene"),void 0===this.scene&&(this.scene=this.baseRenderer.createScene("placental-scene"),this.baseRenderer.setCurrentScene(this.scene)),this.vtkLoader=new w(this.THREE,this.scene.scene),this.vtkLoader.setCopperScene(this.scene),console.log("VTK Loader initialized with camera control")},start:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Loading default placental model..."),t.next=3,e.vtkLoader.loadVTKFile("model/healthy_gen_np3ns1_flux_250_arterial_tree.vtk",{displayName:"Placental Arterial Tree",color:16720418,opacity:.9,modelSize:420,onProgress:function(t,progress){e.modelName="".concat(t," (").concat(Math.round(progress),"%)")},onComplete:function(t,n){e.modelName=n?"Placental Vessel Network (Point Cloud)":"Placental Vessel Network (Enhanced Visualization)",e.scene.loadViewUrl("modelView/noInfarct_view.json"),e.scene.onWindowResize()}});case 3:(n=t.sent).success||(e.modelName="Error: ".concat(n.error.message));case 5:case"end":return t.stop()}}),t)})))()},reloadVTKModel:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("User requested VTK model reload..."),t.next=3,e.vtkLoader.loadVTKFile("model/healthy_gen_np3ns1_flux_250_arterial_tree.vtk",{displayName:"Placental Arterial Tree",color:16724787,opacity:.9,modelSize:420,onProgress:function(t,progress){e.modelName="".concat(t," (").concat(Math.round(progress),"%)")},onComplete:function(t,n){e.modelName=n?"Placental Arterial Tree (Point Cloud)":"Placental Arterial Tree (Reloaded)",e.scene.loadViewUrl("modelView/noInfarct_view.json")}});case 3:(n=t.sent).success||(e.modelName="Error: ".concat(n.error.message));case 5:case"end":return t.stop()}}),t)})))()},loadVenousTree:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.vtkLoader.loadVTKFile("model/healthy_gen_np3ns1_flux_250_venous_tree.vtk",{displayName:"Placental Venous Tree",color:2237183,opacity:.8,modelSize:420,onProgress:function(t,progress){e.modelName="".concat(t," (").concat(Math.round(progress),"%)")},onComplete:function(t,n){e.modelName=n?"Placental Venous Tree (Point Cloud)":"Placental Venous Tree (Enhanced)",e.scene.loadViewUrl("modelView/noInfarct_view.json")}});case 2:(n=t.sent).success||(e.modelName="Error: ".concat(n.error.message));case 4:case"end":return t.stop()}}),t)})))()},loadTerminalVessels:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.vtkLoader.loadVTKFile("model/healthy_gen_np3ns1_flux_250_term.vtk",{displayName:"Placental Terminal Vessels",color:2293538,opacity:.7,modelSize:420,lineWidth:15,pointSize:50,onProgress:function(t,progress){e.modelName="".concat(t," (").concat(Math.round(progress),"%)")},onComplete:function(t,n){e.modelName=n?"Placental Terminal Vessels (Point Cloud)":"Placental Terminal Vessels (Enhanced)",e.scene.loadViewUrl("modelView/noInfarct_view.json")}});case 2:(n=t.sent).success||(e.modelName="Error: ".concat(n.error.message));case 4:case"end":return t.stop()}}),t)})))()},loadModel:function(e,t){this.scene=this.baseRenderer.getSceneByName(t),void 0===this.scene&&(this.scene=this.baseRenderer.createScene(t),this.baseRenderer.setCurrentScene(this.scene),this.scene.loadOBJ(e,(function(content){console.log(content)})),this.scene.loadViewUrl("modelView/noInfarct_view.json")),this.scene.onWindowResize()}},watch:{},beforeDestroy:function(){this.vtkLoader&&(this.vtkLoader.dispose(),this.vtkLoader=null)}},V=y,L=(n(492),n(37)),component=Object(L.a)(V,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"model"},[e._v("\n  "+e._s(e.modelName)+"\n  "),e._v(" "),n("div",{ref:"baseDomObject",class:e.mdAndUp?"baseDom-md":"baseDom-sm"}),e._v(" "),n("button",{on:{click:e.reloadVTKModel}},[e._v("Reload Model")]),e._v(" "),n("button",{on:{click:e.loadVenousTree}},[e._v("Load Venous Tree")]),e._v(" "),n("button",{on:{click:e.loadTerminalVessels}},[e._v("Load Terminal Vessels")])])}),[],!1,null,"5219652c",null);t.default=component.exports},492:function(e,t,n){"use strict";n(475)},493:function(e,t,n){var o=n(25)(!1);o.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Bad+Script&family=Raleway:wght@100;300&display=swap);"]),o.push([e.i,".model-controls[data-v-5219652c]{position:absolute;top:10px;left:10px;z-index:1000;background:rgba(0,0,0,.75);border-radius:8px;padding:10px}.model-controls .control-group[data-v-5219652c]{margin-bottom:8px}.model-controls .control-group[data-v-5219652c]:last-child{margin-bottom:0}",""]),e.exports=o}}]);